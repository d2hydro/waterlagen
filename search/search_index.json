{"config":{"lang":["nl"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Waterlagen","text":"<p>Deze module is bedoeld om alle GIS basislagen (rasters en features) te <code>downloaden</code> en te <code>bewerken</code> voor typische water-toepassingen.</p> <p> </p> <p>Documentatie: https://d2hydro.github.io/waterlagen</p> <p>Broncode: https://github.com/d2hydro/waterlagen</p>"},{"location":"#installeren","title":"Installeren","text":"<p>De module <code>waterlagen</code> kan in elke omgeving die beschikt over <code>Python</code> (&gt;=3.11) en <code>pip</code> met:</p> <pre><code>pip install waterlagen\n</code></pre>"},{"location":"#aan-de-slag","title":"Aan de slag","text":"<p>Wanneer de gebruiker eenmalig een <code>data_dir</code> opgeeft voor de <code>DataStore</code>, worden hier alle downloads, bewerkingen en logs opgeslagen. Lees meer over de DataStore in de documentatie </p>"},{"location":"#downloaden","title":"Downloaden","text":"<p>Het ondersteunen van de volgende lagen vanaf PDOK en AHN.nl wordt ondersteund:</p> <ul> <li>AHN 4 t/m 6</li> <li>BAG</li> <li>BGT</li> </ul> <p>Lees verder in de documentatie </p>"},{"location":"#bewerken","title":"Bewerken","text":"<p>De volgende bewerkingen zijn beschikbaar:</p> <ul> <li>Dichtinterpoleren van AHN DTM</li> <li>Branden van BAG-panden op basis van AHN-hoogte</li> </ul> <p>Lees verder in de documentatie </p>"},{"location":"#ontwikkelaars","title":"Ontwikkelaars","text":"<p>Waterlagen wordt ontwikkeld door D2Hydro en het Hoogheemraadschap Hollands Noorderkwartier met als doel het gestandaardiseerd downloaden en bewerkingen van features en rasters via Python voor toepassingen in het waterbeheer.</p>"},{"location":"bewerkingen/","title":"Bewerkingen","text":""},{"location":"bewerkingen/#bewerkingen","title":"Bewerkingen","text":""},{"location":"bewerkingen/#ahn","title":"AHN","text":"<p>Na een AHN\u2011download werk je verder met de lokale rastertegels (of de VRT). De downloadfunctie levert direct de data die je in bewerkingen nodig hebt. Voor het downloaden van het ahn, en het verkrijgen van de <code>vrt_file</code> hieronder zie Downloads</p> <p>Interpoleren (gaten opvullen) van AHN\u2011tegels kan direct op een VRT. Je krijgt een nieuwe set GeoTIFFs terug, optioneel weer als VRT.</p> <p>Aanroepen: <pre><code>from waterlagen.ahn.interpolate import interpolate_ahn_tiles\n\nfilled_vrt_or_dir = interpolate_ahn_tiles(\n    ahn_vrt_file=vrt_file,\n    max_search_distance=100,\n    dir_name=\"ahn_filled\",\n)\n</code></pre></p>"},{"location":"bewerkingen/#bag","title":"BAG","text":"<p>BAG\u2011bewerkingen starten doorgaans vanuit een GeoDataFrame. Die haal je met \u00e9\u00e9n van de downloadopties op. Voor het ophalen van BAG-panden en het vekrijgen van <code>bag_gdf</code> en de <code>vrt_file</code> zie downloads</p> <p>Rasterize (pand\u2011hoogtekaart) zet BAG\u2011polygons om naar een raster op basis van een DEM. Dit levert een GeoTIFF met vloerpeilen op.</p> <p>Aanroepen: <pre><code>from waterlagen.bag.rasterize import rasterize_bag\nfrom waterlagen import datastore\n\nbag_pand_tif = datastore.processed_data_dir.joinpath(\"bag_pand.tif\")\nrasterize_bag(\n    dem_raster=vrt_file,\n    bag_gdf=bag_gdf,\n    bag_pand_tif=bag_pand_tif,\n    buffer_step_m=1,\n)\n</code></pre></p>"},{"location":"datastore/","title":"DataStore","text":""},{"location":"datastore/#algemeen","title":"Algemeen","text":"<p>De datastore geeft structuur aan het opslaan van downloads en bewerkingen. Standaard wordt een map <code>data</code> aangemaakt relatief tot de huidige werk-map. De mappen <code>source_data</code> en <code>processed_data</code> zijn sub-mappen onder de <code>data</code> map.</p> <p>Optioneel kun je een bestand <code>.datastore</code> in de huidige werk-directory maken met daarin <code>DATA_DIR=pad\\naar\\mijn\\data_store</code>. Op dezelfde manier kun je <code>source_data</code> hierin zetten met <code>SOURCE_DATA=pad\\naar\\mijn\\brongegevens</code> even als <code>processed_data</code> met <code>PROCESSED_DATA=pad\\naar\\mijn\\bewerkte\\gegevens</code>.</p> <p>De DataStore ziet er als volgt uit:</p> <pre><code>data\n\u251c\u2500\u2500 processed_data\n\u2502   \u2514\u2500\u2500 dtm_05\n\u2502       \u251c\u2500\u2500 dtm_05.vrt\n\u2502       \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 source_data\n\u2502   \u251c\u2500\u2500 ahn\n\u2502   \u2502   \u251c\u2500\u2500 dtm_05.vrt\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u251c\u2500\u2500 bag\n\u2502   \u2502   \u2514\u2500\u2500 bag-light.gpkg\n\u2502   \u2514\u2500\u2500 bgt\n\u2502       \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 logs\n    \u2514\u2500\u2500 ...\n</code></pre>"},{"location":"datastore/#gebruik","title":"Gebruik","text":"<p>Zie de code referentie. Mocht u bijvoorbeeld willen weten waar de data_dir staat:</p> <pre><code>from waterlagen import datastore\n\nprint(datastore.data_dir)\n</code></pre>"},{"location":"downloads/","title":"Downloads","text":""},{"location":"downloads/#algemeen","title":"Algemeen","text":"<p>Voor het downloaden van gegevens maken we gebruik van bekende (REST) services op PDOK. Voor het AHN is er ook een download vanuit de AHN.nl beschikbaar.</p>"},{"location":"downloads/#ahn","title":"AHN","text":"<p>De AHN-download haalt DTM/DSM rastertegels binnen op 0.5m of 5m resolutie en zet die lokaal weg. Je krijgt standaard een VRT terug waarmee alle tegels als \u00e9\u00e9n raster te openen zijn.</p> <p>Aanroepen: <pre><code>from waterlagen.ahn.download import get_ahn_rasters\n\n# Download DTM 0.5m voor heel Nederland (of alleen ontbrekende tegels)\nvrt_file = get_ahn_rasters()\n\n# Download DSM 5m, alleen binnen een polygon-masker\nvrt_file = get_ahn_rasters(model=\"dsm\", cell_size=\"5\", poly_mask=my_polygon)\n</code></pre></p> <p>Voor alle opties zie de code-referentie</p>"},{"location":"downloads/#bag","title":"BAG","text":"<p>Voor BAG kun je \u00f3f direct via WFS downloaden (met bbox\u2011filter), \u00f3f de landelijke \"bag\u2011light\" GeoPackage ophalen en daaruit selecteren.</p> <p>Aanroepen: <pre><code>from waterlagen.bag.download import download_bag_light, get_bag_features\n\n# Download de landelijke bag-light.gpkg\nbag_gpkg = download_bag_light()\n\n# Download BAG features binnen bbox via WFS\nbag_gdf = get_bag_features(bbox, layer=\"pand\", source=\"wfs\")\n\n# Of lezen uit bag-light\nbag_gdf = get_bag_features(bbox, layer=\"pand\", source=\"bag-light\")\n</code></pre> Voor alle opties zie de code-referentie</p>"},{"location":"downloads/#bgt","title":"BGT","text":"<p>De BGT\u2011download werkt in drie stappen: request indienen, status pollen, en het resultaat als GeoPackages opslaan. Met <code>get_bgt_features</code> gebeurt dit in \u00e9\u00e9n call.</p> <p>Aanroepen: <pre><code>from waterlagen.bgt.download import get_bgt_features\nfrom waterlagen import datastore\n\n# Download enkele featuretypes binnen een polygon of bbox\nout_dir = get_bgt_features(\n    featuretypes=[\"waterdeel\", \"pand\"],\n    poly_mask=my_polygon_or_bbox,\n    download_dir=datastore.bgt_dir,\n)\n</code></pre></p> <p>Voor alle opties zie de code-referentie</p>"},{"location":"notebooks/dem_alkmaar/","title":"DEM Alkmaar","text":"In\u00a0[8]: Copied! <pre>import geopandas as gpd\nimport matplotlib.pyplot as plt\nimport rasterio\nfrom rasterio.windows import from_bounds\nfrom shapely.geometry import box\n\nfrom waterlagen import datastore\nfrom waterlagen.ahn.download import get_ahn_rasters\nfrom waterlagen.ahn.interpolate import interpolate_ahn_tiles\nfrom waterlagen.bag.download import get_bag_features\nfrom waterlagen.bag.rasterize import rasterize_bag\nfrom waterlagen.logger import init_logger\nfrom waterlagen.raster import create_vrt_file\n</pre> import geopandas as gpd import matplotlib.pyplot as plt import rasterio from rasterio.windows import from_bounds from shapely.geometry import box  from waterlagen import datastore from waterlagen.ahn.download import get_ahn_rasters from waterlagen.ahn.interpolate import interpolate_ahn_tiles from waterlagen.bag.download import get_bag_features from waterlagen.bag.rasterize import rasterize_bag from waterlagen.logger import init_logger from waterlagen.raster import create_vrt_file In\u00a0[9]: Copied! <pre>name = \"dem_alkmaar\"\nlogger = init_logger(name=name, log_file=datastore.data_dir / f\"{name}.log\")\n\nbbox = [110960, 515600, 112560, 516760]\npoly_mask = box(*bbox)\ngpd.GeoSeries([poly_mask], crs=28992).explore()\n</pre> name = \"dem_alkmaar\" logger = init_logger(name=name, log_file=datastore.data_dir / f\"{name}.log\")  bbox = [110960, 515600, 112560, 516760] poly_mask = box(*bbox) gpd.GeoSeries([poly_mask], crs=28992).explore() Out[9]: Make this Notebook Trusted to load map: File -&gt; Trust Notebook In\u00a0[10]: Copied! <pre>ahn_vrt = get_ahn_rasters(poly_mask=poly_mask)\n</pre> ahn_vrt = get_ahn_rasters(poly_mask=poly_mask) In\u00a0[11]: Copied! <pre>bag_gdf = get_bag_features(bbox, layer=\"pand\", source=\"wfs\")\n</pre> bag_gdf = get_bag_features(bbox, layer=\"pand\", source=\"wfs\") <pre>INFO waterlagen.bag.download: Start downloading BAG bag:pand using WFS, 1000 features per page (download)\n</pre> <pre>Downloading page: 07</pre> In\u00a0[12]: Copied! <pre>ahn_filled_vrt = interpolate_ahn_tiles(ahn_vrt_file=ahn_vrt)\n</pre> ahn_filled_vrt = interpolate_ahn_tiles(ahn_vrt_file=ahn_vrt) <pre>INFO waterlagen.ahn.interpolate: start interpolating M_19BZ1 (1/1)\nINFO waterlagen.ahn.interpolate: writing d:\\repositories\\waterlagen\\data\\processed_data\\ahn_filled\\M_19BZ1.tif\nINFO waterlagen.raster: VRT file created d:\\repositories\\waterlagen\\data\\processed_data\\ahn_filled\\ahn_filled.vrt\n</pre> In\u00a0[13]: Copied! <pre>out_tif = datastore.processed_data_dir / \"bag_pand.tif\"\nrasterize_bag(\n    dem_raster=ahn_filled_vrt,\n    bag_gdf=bag_gdf,\n    bag_pand_tif=out_tif,\n    buffer_step_m=1,\n)\n</pre> out_tif = datastore.processed_data_dir / \"bag_pand.tif\" rasterize_bag(     dem_raster=ahn_filled_vrt,     bag_gdf=bag_gdf,     bag_pand_tif=out_tif,     buffer_step_m=1, ) In\u00a0[14]: Copied! <pre>dem_vrt = datastore.processed_data_dir / \"dem.vrt\"\ndem_vrt = create_vrt_file(\n    vrt_file=dem_vrt,\n    directory=[\n        ahn_filled_vrt.parent,\n        datastore.processed_data_dir,\n    ],\n)\n\n\nwith rasterio.open(dem_vrt) as src:\n    window = from_bounds(*bbox, transform=src.transform)\n    data = src.read(1, window=window, masked=True)\n    transform = src.window_transform(window)\n\nfig, ax = plt.subplots(figsize=(6, 6))\nax.imshow(\n    data,\n    extent=(bbox[0], bbox[2], bbox[1], bbox[3]),\n    origin=\"upper\",\n    cmap=\"terrain\",\n)\nplt.axis(\"off\")\nplt.show()\n</pre> dem_vrt = datastore.processed_data_dir / \"dem.vrt\" dem_vrt = create_vrt_file(     vrt_file=dem_vrt,     directory=[         ahn_filled_vrt.parent,         datastore.processed_data_dir,     ], )   with rasterio.open(dem_vrt) as src:     window = from_bounds(*bbox, transform=src.transform)     data = src.read(1, window=window, masked=True)     transform = src.window_transform(window)  fig, ax = plt.subplots(figsize=(6, 6)) ax.imshow(     data,     extent=(bbox[0], bbox[2], bbox[1], bbox[3]),     origin=\"upper\",     cmap=\"terrain\", ) plt.axis(\"off\") plt.show() <pre>INFO waterlagen.raster: VRT file created d:\\repositories\\waterlagen\\data\\processed_data\\dem.vrt\n</pre>"},{"location":"notebooks/dem_alkmaar/#aanpak","title":"Aanpak\u00b6","text":"<p>We gaan een DEM maken voor een klein stukje Alkmaar in de volgende stappen:</p> <ol> <li>Downloaden AHN</li> <li>Downloaden BAG</li> <li>Dichtinterpoleren AHN</li> <li>Verrasteren BAG op basis van het AHN uit stap 1</li> <li>Raster 3 en 4 samenvoegen in 1 VRT</li> </ol> <p>Hieronder specificeren we de logger; die schrijft direct een logfile in de DataStore</p>"},{"location":"notebooks/dem_alkmaar/#downloaden-ahn","title":"Downloaden AHN\u00b6","text":""},{"location":"notebooks/dem_alkmaar/#downloaden-bag","title":"Downloaden BAG\u00b6","text":""},{"location":"notebooks/dem_alkmaar/#dichtinterpoleren-ahn","title":"Dichtinterpoleren AHN\u00b6","text":""},{"location":"notebooks/dem_alkmaar/#verrasteren-vloerpeilen","title":"Verrasteren vloerpeilen\u00b6","text":""},{"location":"notebooks/dem_alkmaar/#samenvoegen","title":"Samenvoegen\u00b6","text":""},{"location":"reference/ahn/","title":"AHN","text":""},{"location":"reference/ahn/#waterlagen.ahn.AHNService","title":"<code>AHNService</code>","text":"<p>               Bases: <code>BaseModel</code></p>"},{"location":"reference/ahn/#waterlagen.ahn.AHNService.get_tiles","title":"<code>get_tiles(model='dtm', cell_size='05', ahn_version=4)</code>","text":"<p>Get AHN tiles in a GeoDataFrame</p>"},{"location":"reference/ahn/#waterlagen.ahn.AHNService.get_tiles_url","title":"<code>get_tiles_url(model='dtm', cell_size='05', ahn_version=4)</code>","text":"<p>Get tiles url of AHN download service</p>"},{"location":"reference/ahn/#waterlagen.ahn.create_download_dir","title":"<code>create_download_dir(root_dir, model='dtm', cell_size='05', ahn_version=4)</code>","text":"<p>Create a logic/unique download_dir as sub-directory of root_dir</p> <p>Parameters:</p> Name Type Description Default <code>root_dir</code> <code>Path</code> <p>Root directory to create sub-directory for</p> required <code>model</code> <code>Literal[&amp;quot;dtm&amp;quot;, &amp;quot;dsm&amp;quot;]</code> <p>ahn model-type, by default \"dtm\"</p> <code>'dtm'</code> <code>cell_size</code> <code>Literal[&amp;quot;05&amp;quot;, &amp;quot;5&amp;quot;]</code> <p>ahn cell_size, by default \"05\"</p> <code>'05'</code> <code>ahn_version</code> <code>Literal[1, 2, 3, 4, 5, 6]</code> <p>ahn version, by default 4</p> <code>4</code> <p>Returns:</p> Type Description <code>Path</code> <p>ahn_directory</p>"},{"location":"reference/ahn/#waterlagen.ahn.get_ahn_rasters","title":"<code>get_ahn_rasters(ahn_dir=datastore.ahn_dir, poly_mask=None, select_indices=None, model='dtm', cell_size='05', ahn_version=4, service='ahn_pdok', missing_only=True, create_vrt=True, save_tiles_index=False)</code>","text":"<p>Downloads AHN rasters</p> <p>Downloads ahn DTM or DSM rasters on 0.5m or 5m resolution</p> <p>Parameters:</p> Name Type Description Default <code>ahn_dir</code> <code>Path</code> <p>Directory to store ahn-files. Defaults to datastore.ahn_dir</p> <code>ahn_dir</code> <code>poly_mask</code> <code>Polygon | None</code> <p>Mask to select ahn-tiles, by default None</p> <code>None</code> <code>select_indices</code> <code>list[str] | None</code> <p>Indices to select, by default None</p> <code>None</code> <code>service</code> <code>Literal['ahn_pdok', 'ahn_datastroom']</code> <p>Switch for using pdok.nl or ahn.nl for downloading ahn_data</p> <code>'ahn_pdok'</code> <code>missing_only</code> <code>bool</code> <p>Only download rasters not yet existing in download_dir, by default True</p> <code>True</code> <code>create_vrt</code> <code>bool</code> <p>Create a vrt-file so all tiles can be opened as one, by default True</p> <code>True</code> <code>save_tiles_index</code> <code>bool</code> <p>Save the tile index as a GeoPackage in the download-dir, by default False</p> <code>False</code> <p>Returns:</p> Type Description <code>Path</code> <p>Path to download dir or vrt_file, being a sub-directory of ahn_root_dir</p>"},{"location":"reference/ahn/#waterlagen.ahn.interpolate_ahn_tiles","title":"<code>interpolate_ahn_tiles(ahn_vrt_file, indices=None, max_search_distance=100, dir_name='ahn_filled', create_vrt=True, missing_only=False)</code>","text":"<p>Interpolate ahn raster tiles</p> <p>Parameters:</p> Name Type Description Default <code>ahn_vrt_file</code> <code>Path</code> <p>VRT file referring to AHN tiles</p> required <code>indices</code> <code>list[str] | None</code> <p>Optional selection of AHN tiles to interpolate, by default None</p> <code>None</code> <code>max_search_distance</code> <code>float</code> <p>Set search_distance for neighbor search and interpolation distance. By default set to 100</p> <code>100</code> <code>dir_name</code> <code>str</code> <p>Optional output dir-name within datastore to store result, by default \"ahn_filled\"</p> <code>'ahn_filled'</code> <code>create_vrt</code> <code>bool</code> <p>Switch for generating a vrt-file for resulting rasters, by default True</p> <code>True</code> <code>missing_only</code> <code>bool</code> <p>Interpolate only rasters that haven't been interpolated yet, by default False</p> <code>False</code> <p>Returns:</p> Type Description <code>Path</code> <p>Path to VRT-file (create_vrt=True) or destination directory</p>"},{"location":"reference/bag/","title":"BAG","text":""},{"location":"reference/bag/#waterlagen.bag.download_bag_light","title":"<code>download_bag_light(download_dir=datastore.bag_dir, overwrite=True)</code>","text":"<p>Download BAG for The Netherlands</p> <p>Parameters:</p> Name Type Description Default <code>download_dir</code> <code>Path</code> <p>Download dir to store GeoPackages. By default datastore.bag_dir</p> <code>bag_dir</code> <code>overwrite</code> <code>bool</code> <p>If not True BAG will only be downloaded if not existing. Default is True</p> <code>True</code> <p>Returns:</p> Type Description <code>Path</code> <p>Path to BAG GeoPackage</p>"},{"location":"reference/bag/#waterlagen.bag.get_bag_features","title":"<code>get_bag_features(bbox, *, layer='pand', source='wfs', bag_light_gpkg=datastore.bag_dir.joinpath('bag-light.gpkg'), wfs_crs=28992)</code>","text":"<p>Get BAG features</p> <p>Use <code>source=wfs</code> to use the BAG wfs. Note (!) BAG only allows you to extract 50000 features. If your bbox is too large, you'll get an incomplete result Use <code>source=bag-light</code> to extract from an existing bag-light GeoPackage. This file can be downloaded with the <code>download_bag_light</code> function in the <code>waterlagen.bag</code> module</p> <p>Parameters:</p> Name Type Description Default <code>bbox</code> <code>tuple[float, float, float, float] | None</code> <p>Extent with (xmin, ymin, xmax, ymax). BAG will be downloaded for this extent only.</p> required <code>layer</code> <code>Literal['pand', 'verblijfsobject']</code> <p>Layer to extract/download, by default \"pand\"</p> <code>'pand'</code> <code>source</code> <code>Literal['bag-light', 'wfs']</code> <p>Source to extract/download features from, by default \"wfs\"</p> <code>'wfs'</code> <code>bag_light_gpkg</code> <code>Union[Path, str]</code> <p>bag_light GeoPackage to extract features from with <code>source=bag-light</code>, by default it will be found in the datastore at <code>datastore.bag_dir.joinpath(\"bag-light.gpkg\")</code></p> <code>joinpath('bag-light.gpkg')</code> <code>wfs_crs</code> <code>int</code> <p>CRS to use for extracting BAG features from WFS, by default 28992</p> <code>28992</code> <p>Returns:</p> Type Description <code>GeoDataFrame</code> <p>GeoDataFrame with BAG-features</p>"},{"location":"reference/bgt/","title":"BGT","text":""},{"location":"reference/bgt/#waterlagen.bgt.get_bgt_features","title":"<code>get_bgt_features(featuretypes, poly_mask, download_dir)</code>","text":"<p>Download BGT features in GeoPackages</p> <p>Parameters:</p> Name Type Description Default <code>featuretypes</code> <code>Iterable[str]</code> <p>BGT feature-types, e.g. [\"waterdeel\", \"pand\"]</p> required <code>poly_mask</code> <code>shape | None</code> <p>Optional polygon-mask to use as geofilter. If not Polygon, shape-bounding box will be used. By default None</p> required <code>download_dir</code> <code>Path</code> <p>Download dir to store GeoPackages</p> required <p>Returns:</p> Type Description <code>Path</code> <p>Download dir to store GeoPackages</p>"},{"location":"reference/datastore/","title":"DataStore","text":""},{"location":"reference/datastore/#waterlagen.datastore.DataStore","title":"<code>DataStore</code>","text":"<p>               Bases: <code>BaseSettings</code></p> <p>DataStore to structurally store downloaded and processed data.</p> <p>Input arguments <code>data_dir</code>, <code>processed_data_dir</code> and <code>processed_data_dir</code> can be set in an env-file <code>.datastore</code>:</p> <pre><code>DATA_DIR=path/to/data/dir\nSOURCE_DATA=path/to/source/data\nPROCESSED_DATA=path/to/processed/data\n</code></pre> <p>Parameters:</p> Name Type Description Default <code>data_dir</code> <code>Path</code> <p>The root for <code>source_data_dir</code> and <code>processed_data_dir</code>. Defaults to ./data.</p> required <code>source_data_dir</code> <code>Path</code> <p>A path for for source data, defaults to <code>data/source_data</code></p> required <code>processed_data_dir</code> <code>Path</code> <p>A path for for processed data, defaults to <code>data/processed_data_dir</code></p> required"}]}